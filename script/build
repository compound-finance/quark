#!/bin/bash

set -eo pipefail
forge build --contracts ./src/ --skip ".sol"
quarkYul="$(cat out/Quark.yul/Quark.json | jq -r '.bytecode .object' | cut -c 3-)"
sed -E -i '' "s/return hex\"[a-zA-Z0-9]*\"/return hex\"$quarkYul\"/g" ./src/RelayerMetamorphic.sol

forge build --contracts ./src/ --skip ".yul"  --via-ir --optimize --optimizer-runs 200
